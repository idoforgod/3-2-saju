# PRD: 구독제 사주분석 서비스

**버전**: 1.0
**작성일**: 2025-10-26
**작성자**: Product Team
**상태**: Draft

---

## 1. 제품 개요

### 1.1 서비스 소개

**제품명**: 구독제 사주분석 서비스
**핵심 가치**: "AI 기반 즉시 사주 상담"

본 서비스는 전통적인 사주팔자 상담을 현대적인 AI 기술과 결합하여, 사용자가 언제 어디서나 즉시 개인화된 사주 분석을 받을 수 있는 구독 기반 SaaS 플랫폼입니다.

### 1.2 문제 정의

**현재 시장의 문제점:**
- 전통적인 사주 상담은 시간과 비용이 많이 소요됨 (1회 3~10만원, 대면 방문 필요)
- 온라인 무료 서비스는 품질이 낮고 신뢰도가 부족함
- 반복 상담이 필요한 경우 비용 부담이 큼
- 상담사 예약 대기 시간이 길고 접근성이 낮음

**우리의 솔루션:**
- AI 기반 즉시 분석: 24/7 언제든 바로 결과 확인
- 합리적인 가격: 무료 체험 3회 + 월 구독 모델
- 일관된 품질: Google Gemini AI 기반 전문 분석
- 재분석 자유: Pro 구독자는 월 10회까지 다양한 질문 가능

### 1.3 핵심 가치 제안

**사용자 관점:**
- ⏱️ **즉시성**: 입력 후 30초 이내 분석 결과 제공
- 💰 **경제성**: 무료 체험 → 월 9,900원 구독 (기존 대면 상담 대비 90% 절감)
- 🔄 **반복성**: 구독자는 원하는 만큼 다양한 각도로 재분석 가능
- 📱 **접근성**: 모바일/데스크톱 어디서나 간편 이용

**비즈니스 관점:**
- 💳 **안정적 수익**: 구독 기반 경상수익 모델
- 🤖 **확장성**: AI 기반으로 동시 처리 무제한
- 📊 **데이터 자산**: 사용자 분석 이력 데이터 축적
- 🚀 **낮은 마진**: 인건비 최소화, AI API 비용만 발생

---

## 2. Stakeholders (이해관계자)

### 2.1 핵심 이해관계자

| 역할 | 이해관계 | 의사결정 권한 |
|------|---------|-------------|
| **Product Owner** | 서비스 성공 및 KPI 달성 | 제품 방향성 최종 결정 |
| **Dev Team** | 기술 스택 및 아키텍처 설계 | 구현 방식 결정 |
| **QA Team** | 품질 보증 및 버그 예방 | 배포 가부 결정 |
| **CS Team** | 사용자 문의 대응 및 만족도 관리 | 고객 정책 권고 |
| **Finance Team** | 수익 구조 및 결제 안정성 | 결제 정책 승인 |

### 2.2 외부 의존성

| 서비스 | 의존도 | 리스크 | 대응 계획 |
|--------|-------|-------|---------|
| **Clerk** | 높음 (인증) | 서비스 장애 시 로그인 불가 | Fallback 인증 방식 검토 |
| **Toss Payments** | 높음 (결제) | 결제 장애 시 신규 구독 불가 | 장애 안내 및 재시도 자동화 |
| **Google Gemini** | 높음 (AI 분석) | API 할당량 초과 또는 장애 | Quota 모니터링 및 알림 |
| **Supabase** | 중간 (DB/Cron) | DB 장애 시 서비스 중단 | 자동 백업 및 복구 절차 |
| **Vercel** | 중간 (배포) | 배포 장애 | GitHub Actions 대체 배포 |

---

## 3. 포함 페이지

### 3.1 페이지 목록

| # | 페이지명 | 경로 | 인증 필요 | 주요 기능 | 우선순위 |
|---|---------|------|----------|----------|---------|
| 1 | **랜딩 페이지** | `/` | ❌ | 서비스 소개, 가격 안내, 로그인 CTA | P0 |
| 2 | **대시보드** | `/dashboard` | ✅ | 분석 이력, 남은 쿼터, 구독 상태 요약 | P0 |
| 3 | **새 분석** | `/analysis/new` | ✅ | 사주 정보 입력, AI 분석 요청 | P0 |
| 4 | **분석 상세** | `/analysis/[id]` | ✅ | 과거 분석 결과 조회, 마크다운 렌더링 | P0 |
| 5 | **구독 관리** | `/subscription` | ✅ | 구독 상태 조회, 결제 내역, 취소/재활성화 | P0 |

### 3.2 페이지별 상세 요구사항

#### 3.2.1 랜딩 페이지 (`/`)

**목적**: 신규 방문자 전환율 극대화

**구성 요소:**
- Hero Section
  - 메인 헤드라인: "AI가 분석하는 당신의 사주팔자"
  - 서브 헤드라인: "24시간 즉시 상담 | 무료 체험 3회 제공"
  - CTA 버튼: "무료로 시작하기" → Google 로그인
  - 히어로 이미지: 사주 관련 일러스트 (placeholder)

- Features Section
  - ⏱️ 즉시 분석 (30초 이내 결과)
  - 🤖 Gemini AI 기반 전문 상담
  - 💰 합리적인 가격 (월 9,900원)
  - 📊 과거 분석 이력 무제한 보관

- Pricing Section
  - 무료 플랜: 총 3회 체험, Gemini Flash 모델
  - Pro 플랜: 월 10회, Gemini Pro 모델, 월 9,900원
  - 비교표: 무료 vs Pro 기능 차이

- Footer
  - 회사 정보, 이용약관, 개인정보처리방침

**접근 권한**: 전체 공개
**주요 전환 목표**: 로그인 전환율 30% 이상

---

#### 3.2.2 대시보드 (`/dashboard`)

**목적**: 사용자 현황 한눈에 파악 및 주요 액션 유도

**구성 요소:**
- 상단 요약 카드
  - 남은 쿼터: `8회 남음` (10회 중)
  - 구독 상태: `Pro 구독 중` (다음 결제일: 2025-11-26)
  - 빠른 액션 버튼: "새 분석하기"

- 최근 분석 이력 (최신 5개)
  - 분석일시, 이름, 생년월일
  - 카드 클릭 시 상세 페이지 이동
  - "전체 보기" 링크

- 구독 상태 위젯
  - 현재 플랜 정보
  - 다음 결제일 및 금액
  - "구독 관리" 버튼

- 비어있는 상태 (Empty State)
  - 분석 이력 없을 때: "첫 분석을 시작해보세요!" CTA

**접근 권한**: 로그인 필수
**로딩 성능**: 초기 렌더링 1초 이내

---

#### 3.2.3 새 분석 (`/analysis/new`)

**목적**: 사주 정보 입력 및 즉시 분석 제공

**구성 요소:**
- 쿼터 안내
  - 상단 배너: "남은 분석 횟수: 8회 | Pro 플랜"
  - 쿼터 부족 시: "Pro 구독하고 매월 10회 이용하세요" CTA

- 입력 폼
  - 이름: `text input` (필수)
  - 생년월일: `date picker` (필수)
  - 출생시간: `time picker` (선택) - 모르면 "시간 미상" 자동 설정
  - 성별: `radio button` - 남성/여성 (필수)

- 제출 버튼: "사주 분석 시작"
  - 로딩 상태: 스피너 + "AI가 분석 중입니다..." (30초 소요)

- 결과 표시
  - 분석 완료 후 같은 페이지에서 마크다운 렌더링
  - "대시보드로 돌아가기" 버튼
  - "다른 사람 분석하기" 버튼

**검증 규칙:**
- 이름: 2자 이상 50자 이하
- 생년월일: 1900-01-01 ~ 오늘
- 성별: 필수 선택

**에러 처리:**
- 쿼터 부족: "남은 분석 횟수가 없습니다. Pro 구독을 이용해주세요."
- Gemini API 오류: "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요."
- 네트워크 오류: "인터넷 연결을 확인해주세요."

**접근 권한**: 로그인 + 쿼터 필요
**성능 목표**: 분석 결과 30초 이내 제공

---

#### 3.2.4 분석 상세 (`/analysis/[id]`)

**목적**: 과거 분석 결과 재확인

**구성 요소:**
- 분석 메타 정보
  - 분석일시: 2025-10-26 15:30
  - 이름: 홍길동
  - 생년월일: 1990-01-01
  - 출생시간: 10:30 (또는 "시간 미상")
  - 성별: 남성
  - 사용 모델: Gemini 2.5 Pro

- 분석 결과
  - 마크다운 렌더링 (섹션별 구분)
  - 스크롤 가능한 긴 콘텐츠

- 액션 버튼
  - "다시 분석하기" (새 쿼터 소진)
  - "대시보드로" 버튼

**접근 권한**: 로그인 + 본인 분석만
**성능 목표**: 페이지 로딩 1초 이내

---

#### 3.2.5 구독 관리 (`/subscription`)

**목적**: 구독 상태 조회 및 변경

**구성 요소:**
- 현재 구독 정보
  - 플랜: Pro 구독 중
  - 다음 결제일: 2025-11-26
  - 결제 금액: 9,900원
  - 결제 수단: **** **** **** 1234 (마스킹)

- 구독 상태별 액션
  - **활성 상태**: "구독 취소" 버튼
  - **취소 예약 상태**: "취소 철회" 버튼 + 취소 예정일 표시
  - **해지 상태**: "Pro 구독 시작" 버튼

- 결제 내역
  - 날짜, 금액, 상태 (성공/실패)
  - 최근 12개월 내역만 표시

**모달 확인:**
- 구독 취소: "다음 결제일(2025-11-26)까지 Pro 혜택이 유지됩니다. 취소하시겠습니까?"
- 취소 철회: "구독을 다시 활성화하시겠습니까? 정기 결제가 재개됩니다."
- 즉시 해지: "즉시 해지 시 남은 기간 환불이 불가능합니다. 계속하시겠습니까?"

**접근 권한**: 로그인 필수
**성능 목표**: 페이지 로딩 1초 이내

---

## 4. 사용자 여정

### 4.1 신규 사용자 여정 (Free → Pro 전환)

**타겟 세그먼트**: 20-40대 직장인, 사주/운세 관심자
**주요 페이지**: `/` → `/dashboard` → `/analysis/new` → `/subscription`

**여정 단계:**

1. **발견 및 가입**
   - 랜딩 페이지 방문
   - 서비스 소개 확인
   - Google 로그인
   - Clerk Webhook으로 Supabase 동기화
   - 무료 쿼터 3회 자동 부여

2. **무료 체험**
   - 대시보드 진입
   - 첫 분석 시도
   - 생년월일 입력
   - Gemini Flash 분석 결과 확인
   - 2-3회 반복 사용

3. **유료 전환**
   - 쿼터 소진 알림
   - Pro 플랜 가격 확인
   - 토스 결제 위젯 열기
   - 카드 정보 입력
   - BillingKey 발급 및 첫 결제
   - Pro 구독 활성화

4. **Pro 사용**
   - Gemini Pro 모델 사용
   - 월 10회 반복 분석
   - 정기 결제 자동화

**전환 최적화 포인트:**
- 랜딩 페이지 CTA 명확성
- 무료 체험 가치 강조
- 쿼터 소진 시점 안내 문구
- 결제 과정 간소화 (토스 간편결제)

---

### 4.2 기존 사용자 여정 (Pro 구독 유지)

**타겟 세그먼트**: 기존 Pro 구독자
**주요 페이지**: `/dashboard` → `/analysis/new` → `/analysis/[id]` → `/subscription`

**여정 단계:**

1. **월초 (결제 후)**
   - 정기 결제 자동 성공
   - 쿼터 10회 리셋
   - 이메일 결제 알림 수신

2. **월중 (활발한 사용)**
   - 대시보드 접속
   - 중요 결정 전 분석 활용
   - 가족 사주 분석
   - 남은 쿼터 확인

3. **월말 (구독 관리)**
   - 구독 관리 페이지 접속
   - 다음 결제일 확인
   - 구독 유지 결정

**이탈 방지 포인트:**
- 월 10회 쿼터의 적정성
- 분석 품질 만족도
- 결제 실패 시 즉각 알림 및 재시도 안내

---

### 4.3 구독 취소 및 재활성화 여정

**타겟 세그먼트**: 구독 취소 고려자
**주요 페이지**: `/subscription`

**여정 단계:**

1. **취소 결정**
   - 구독 관리 페이지 접속
   - "구독 취소" 버튼 클릭
   - 취소 확인 모달
   - 취소 처리
   - 결제일까지 Pro 유지 안내

2. **마음 변화**
   - 구독 관리 페이지 재방문
   - 취소 예정 상태 확인
   - "취소 철회" 버튼 클릭
   - 구독 재활성화

3. **결제일 도래**
   - 자동 결제 성공
   - 구독 연장

**Retention 최적화:**
- 취소 시 할인 쿠폰 제안 (향후 추가)
- 취소 철회 유도 문구
- 결제일 7일 전 리마인더 이메일

---

## 5. 정보 구조 (IA - Information Architecture)

### 5.1 사이트맵 (Tree 구조)

```
📁 구독제 사주분석 서비스
│
├── 🏠 랜딩 페이지 (/)
│   ├── Hero Section
│   ├── Features
│   ├── Pricing
│   └── CTA: 로그인
│
├── 🔐 인증 (Clerk 컴포넌트)
│   ├── 로그인 (/sign-in)
│   ├── 회원가입 (/sign-up)
│   └── 회원 정보 (/profile)
│
├── 📊 대시보드 (/dashboard)
│   ├── 요약 위젯
│   │   ├── 남은 쿼터
│   │   ├── 구독 상태
│   │   └── 다음 결제일
│   ├── 최근 분석 이력 (5개)
│   └── CTA: 새 분석하기
│
├── 🔮 분석 기능
│   ├── 새 분석 (/analysis/new)
│   │   ├── 입력 폼
│   │   ├── 쿼터 확인
│   │   ├── Gemini API 호출
│   │   └── 결과 표시
│   └── 분석 상세 (/analysis/[id])
│       ├── 메타 정보
│       ├── 마크다운 결과
│       └── 액션 버튼
│
└── 💳 구독 관리 (/subscription)
    ├── 현재 구독 정보
    ├── 결제 수단 관리
    ├── 결제 내역
    └── 액션
        ├── 구독 취소
        ├── 취소 철회
        └── 즉시 해지
```

### 5.2 네비게이션 구조

**글로벌 네비게이션 (헤더)**
```
[로고] [대시보드] [새 분석] [구독 관리] [사용자 프로필 ▼]
                                               ├─ 내 정보
                                               └─ 로그아웃
```

**모바일 네비게이션 (햄버거 메뉴)**
```
☰ Menu
├── 대시보드
├── 새 분석
├── 구독 관리
├── 내 정보
└── 로그아웃
```

---

## 6. 기술 스택

### 6.1 Frontend

| 구성 요소 | 기술 | 버전 | 선택 이유 |
|---------|------|------|----------|
| **Framework** | Next.js | 14.x | App Router, SSR, 최적화된 성능 |
| **Language** | TypeScript | 5.x | 타입 안정성, IDE 지원 |
| **Styling** | Tailwind CSS | 3.x | 빠른 개발, 일관된 디자인 시스템 |
| **UI Components** | shadcn/ui | Latest | 접근성 좋은 고품질 컴포넌트 |
| **Form** | React Hook Form | 7.x | 성능, Zod 통합 |
| **Validation** | Zod | 3.x | 타입 안전한 스키마 검증 |
| **State** | Context API | - | 간단하고 충분한 상태 관리 |
| **Markdown** | react-markdown | 9.x | 분석 결과 렌더링 |
| **Toast** | sonner | 1.x | 사용자 피드백 |

### 6.2 Backend

| 구성 요소 | 기술 | 버전 | 선택 이유 |
|---------|------|------|----------|
| **API** | Next.js API Routes | 14.x | 프론트엔드 통합, Vercel 최적화 |
| **Auth** | Clerk | Latest | 간편한 OAuth 통합, Webhook 제공 |
| **Database** | Supabase (PostgreSQL) | Latest | 관리형 DB, Cron 제공 |
| **Payment** | Toss Payments | v1 | 한국 시장 최적화, 간편결제 |
| **AI** | Google Gemini | 2.5 | 고품질 생성 AI, Flash/Pro 선택 가능 |
| **Scheduler** | Supabase Cron | - | 서버리스 환경 Cron 대안 |

### 6.3 Infrastructure

| 구성 요소 | 기술 | 선택 이유 |
|---------|------|----------|
| **Deployment** | Vercel | 자동 배포, 글로벌 CDN, Edge Functions |
| **Domain** | Vercel Domains | 통합 관리 |
| **Analytics** | Vercel Analytics | 성능 모니터링 |
| **Error Tracking** | Sentry (향후) | 실시간 에러 추적 |
| **CI/CD** | Vercel Git Integration | Push 시 자동 배포 |

---

## 7. 성공 지표 (Success Metrics)

### 7.1 비즈니스 지표 (Business KPIs)

| 지표 | 목표 | 측정 방법 | 주기 |
|------|------|----------|------|
| **신규 가입자 수** | 500명/월 | Clerk Dashboard | 주간 |
| **무료→Pro 전환율** | 15% | Supabase 쿼리 | 주간 |
| **Pro 구독자 유지율** | 80% (월간) | Churn Rate 계산 | 월간 |
| **월 경상수익 (MRR)** | 300만원/월 | Toss 결제 내역 합산 | 월간 |
| **ARPU** | 9,900원/월 | MRR ÷ Pro 구독자 수 | 월간 |
| **LTV** | 118,800원 (12개월 기준) | ARPU × 평균 구독 기간 | 분기 |
| **CAC** | 5,000원/명 (목표) | 마케팅 비용 ÷ 신규 가입자 | 월간 |

### 7.2 사용자 경험 지표 (UX Metrics)

| 지표 | 목표 | 측정 방법 | 주기 |
|------|------|----------|------|
| **분석 성공률** | 99% | (성공 건수 ÷ 전체 시도) × 100 | 주간 |
| **평균 분석 시간** | < 30초 | Gemini API 응답 시간 | 일간 |
| **페이지 로딩 속도** | < 2초 (TTI) | Vercel Analytics | 일간 |
| **사용자 만족도** | 4.5/5 (향후) | 설문 조사 | 분기 |
| **반복 사용률** | 60% | 월 2회 이상 로그인 비율 | 주간 |

### 7.3 기술 지표 (Technical Metrics)

| 지표 | 목표 | 측정 방법 | 주기 |
|------|------|----------|------|
| **서비스 가동률** | 99.9% | Vercel Uptime | 월간 |
| **API 에러율** | < 0.1% | Sentry Error Rate | 일간 |
| **결제 성공률** | 98% | 토스 결제 성공/실패 비율 | 주간 |
| **Cron 실행 성공률** | 100% | Supabase Cron 로그 | 일간 |
| **Gemini API 할당량** | < 80% 사용 | Google Cloud Console | 일간 |

---

## 8. 우선순위 (Prioritization)

### 8.1 MoSCoW 우선순위

#### Must Have (P0 - MVP 필수)
- Google OAuth 로그인 (Clerk)
- Clerk Webhook 연동 (user.created, user.deleted)
- 무료 쿼터 3회 부여
- 사주 정보 입력 및 검증
- Gemini API 호출 (Flash/Pro 구분)
- 분석 결과 저장 및 표시
- 쿼터 차감 로직
- Pro 구독 결제 플로우 (토스 BillingKey)
- 구독 상태 관리 (활성/취소/해지)
- 정기 결제 자동화 (Supabase Cron)
- 5개 페이지 구현 (랜딩, 대시보드, 새 분석, 상세, 구독 관리)

#### Should Have (P1 - 론칭 직후)
- 회원 탈퇴 기능
- 즉시 해지 기능
- 결제 내역 조회
- 분석 이력 전체 보기
- 재분석 기능
- 에러 로깅 (Sentry)
- 빈 상태 디자인

#### Could Have (P2 - 향후 개선)
- 가족 멀티 프로필
- 분석 결과 PDF 다운로드
- 커뮤니티 기능
- 사용자 리뷰
- 쿼터 사용 통계 차트
- 분석 결과 공유 기능
- 취소 사유 설문
- 할인 쿠폰 시스템

#### Won't Have (현재 버전 제외)
- 모바일 네이티브 앱
- 다국어 지원
- 전문 상담사 매칭
- 실시간 채팅 상담
- 음성 입력
- AR/VR 사주 체험

---

## 9. 향후 로드맵 (Future Roadmap)

### Q4 2025: MVP 론칭 및 초기 운영
- ✅ 5개 페이지 구현
- ✅ Clerk + Supabase + Toss + Gemini 통합
- ✅ 정기 결제 자동화
- 초기 마케팅 (블로그, 유튜브 협업)
- 사용자 피드백 수집

### Q1 2026: 기능 개선 및 안정화
- 분석 결과 PDF 다운로드
- 결제 내역 상세 조회
- 이메일 알림 자동화 (결제 성공/실패, 쿼터 알림)
- 성능 최적화 (CDN, 이미지 최적화)
- E2E 테스트 자동화

### Q2 2026: 사용자 경험 향상
- 가족 멀티 프로필 기능
- 분석 결과 공유 기능 (SNS)
- 커뮤니티 기능 (댓글, 좋아요)
- 사용자 리뷰 및 평점
- 쿼터 사용 통계 대시보드

### Q3 2026: 수익 다각화
- 프리미엄 플랜 추가 (월 19,900원, 무제한 분석)
- 전문 상담사 1:1 매칭 (별도 요금제)
- 기업용 B2B 플랜 (HR, 채용 컨설팅)
- 제휴 마케팅 (사주 관련 상품 추천)

### Q4 2026: 글로벌 확장
- 다국어 지원 (영어, 중국어)
- 서양 점성술 모드 추가
- 모바일 네이티브 앱 개발
- 해외 결제 수단 추가 (Stripe)

---

## 10. 부록 (Appendix)

### 10.1 환경 변수 체크리스트

```bash
# Clerk
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxxxxxxx
CLERK_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxxxxxxx
CLERK_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxx

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxxxxxxxxxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Toss Payments
TOSS_SECRET_KEY=test_sk_xxxxxxxxxxxxxxxxxxxxx
NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_xxxxxxxxxxxxxxxxxxxxx

# Gemini
GEMINI_API_KEY=AIzaSyxxxxxxxxxxxxxxxxxxxxx

# Cron Secret
CRON_SECRET_TOKEN=your-random-secure-token-here
```

### 10.2 데이터베이스 스키마 요약

**테이블 목록:**
1. `users` - Clerk 사용자 동기화
2. `subscriptions` - 구독 정보 및 쿼터
3. `analyses` - 분석 이력

**주요 관계:**
- `users.clerk_user_id` ← `subscriptions.user_id` (1:1)
- `users.clerk_user_id` ← `analyses.user_id` (1:N)

### 10.3 API 엔드포인트 목록

**인증 (Clerk):**
- `GET /api/user/me` - 현재 사용자 정보

**분석:**
- `POST /api/analysis/create` - 새 분석 생성
- `GET /api/analysis/[id]` - 분석 상세 조회
- `GET /api/analysis/list` - 분석 이력 조회

**구독:**
- `GET /api/subscription/status` - 구독 상태 조회
- `POST /api/subscription/subscribe` - Pro 구독 시작
- `POST /api/subscription/cancel` - 구독 취소
- `POST /api/subscription/reactivate` - 취소 철회
- `DELETE /api/subscription/terminate` - 즉시 해지

**Webhook:**
- `POST /api/webhooks/clerk` - Clerk 이벤트 수신
- `POST /api/webhooks/toss` - Toss 결제 이벤트 (향후)

**Cron:**
- `POST /api/cron/process-billing` - 정기 결제 배치

---

**문서 버전**: 1.0
**최종 수정일**: 2025-10-26
**승인 상태**: Draft (검토 필요)
**다음 리뷰**: 2025-10-30

---

**작성자 서명**:
Product Owner: _______________
Dev Lead: _______________
QA Lead: _______________
